[tools]
go = "latest"
"pipx:pre-commit" = { version = "latest", uvx_args = "--python-preference=system" }
"go:github.com/golangci/golangci-lint/v2/cmd/golangci-lint" = "latest"

[vars]
binary = "debux"
image = "ghcr.io/clement-tourriere/debux:latest"

[tasks.build]
description = "Build the binary with CGO disabled"
run = "CGO_ENABLED=0 go build -o bin/{{vars.binary}} ./cmd/debux"

[tasks.build-dev]
description = "Build the binary for development (with CGO)"
run = "go build -o bin/{{vars.binary}} ./cmd/debux"

[tasks.install]
description = "Build and install the binary to ~/.local/bin"
depends = ["build"]
run = "cp bin/{{vars.binary}} ~/.local/bin/{{vars.binary}}"

[tasks.image-build]
description = "Build the Docker debug image"
run = "docker build -t {{vars.image}} -f images/debug/Dockerfile ."

[tasks.image-push]
description = "Push the Docker debug image"
run = "docker push {{vars.image}}"

[tasks.dev]
description = "Build binary and Docker image for development"
depends = ["build", "image-build"]

[tasks.clean]
description = "Remove build artifacts"
run = "rm -rf bin/"

[tasks.test]
description = "Run tests"
run = "go test ./..."

[tasks.lint]
description = "Run linter"
run = "golangci-lint run"
